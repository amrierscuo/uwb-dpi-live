<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <title>UWB Live Map</title>
  <style>
    body{margin:0;background:#0f172a;color:#e5e7eb;font-family:sans-serif}
    canvas{display:block;margin:20px auto;border:2px solid #1f2937;border-radius:8px}
  </style>
</head>
<body>
  <h1 style="text-align:center">UWB Live Map (100Ã—100 m)</h1>
  <canvas id="map" width="800" height="800"></canvas>

  <script>
  const WORLD={w:100,h:100,
    zones:[{x:15,y:15,w:30,h:22,level:"crit"},
           {x:60,y:50,w:20,h:25,level:"warn"}]};
  const COLORS={ok:"#22c55e",warn:"#f59e0b",crit:"#ef4444"};
  const canvas=document.getElementById("map"),ctx=canvas.getContext("2d");
  const scale=canvas.width/WORLD.w;

  let agents=[{id:"T1",x:20,y:20,vx:1,vy:0.6,status:"ok"},
              {id:"T2",x:40,y:70,vx:-0.5,vy:0.4,status:"ok"}];

  function inside(z,x,y){return x>=z.x&&x<=z.x+z.w&&y>=z.y&&y<=z.y+z.h;}

  function update(dt){
    for(const a of agents){
      a.x+=a.vx*dt;a.y+=a.vy*dt;
      if(a.x<0||a.x>WORLD.w) a.vx*=-1;
      if(a.y<0||a.y>WORLD.h) a.vy*=-1;
      a.status="ok";
      if(inside(WORLD.zones[0],a.x,a.y)) a.status="crit";
      else if(inside(WORLD.zones[1],a.x,a.y)) a.status="warn";
    }
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // zone
    for(const z of WORLD.zones){
      ctx.fillStyle=z.level==="crit"?"rgba(239,68,68,.2)":"rgba(245,158,11,.2)";
      ctx.fillRect(z.x*scale,z.y*scale,z.w*scale,z.h*scale);
    }
    // agents
    for(const a of agents){
      ctx.fillStyle=COLORS[a.status];
      ctx.beginPath();ctx.arc(a.x*scale,a.y*scale,6,0,Math.PI*2);ctx.fill();
      ctx.fillText(a.id,a.x*scale+10,a.y*scale);
    }
  }

  let last=performance.now();
  function loop(){
    const now=performance.now(),dt=(now-last)/1000;last=now;
    update(dt*10);draw();requestAnimationFrame(loop);
  }
  loop();
  </script>
</body>
</html>
